<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ReactJS</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.2/masonry.pkgd.min.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

    <div id="content">
        
    </div>
    
    <div id="carousel-wrap">
        
    </div>
    
    <div id="music-wrap" class="music-wrap">
        
    </div>
    
    <div id="timer-wrap" class="timer-wrap">
        
    </div>
    
    <div id="mount-point">
        
    </div>
    
    <script type="text/babel">
        var CONTACTS = [
            {
                id: 1,
                name: 'Darth Vader',
                phoneNumber: '+250966666666',
                image: 'img/darth.gif'
            }, {
                id: 2,
                name: 'Princess Leia',
                phoneNumber: '+250966344466',
                image: 'img/leia.gif'
            }, {
                id: 3,
                name: 'Luke Skywalker',
                phoneNumber: '+250976654433',
                image: 'img/luke.gif'
            }, {
                id: 4,
                name: 'Chewbacca',
                phoneNumber: '+250456784935',
                image: 'img/chewbacca.gif'
            }
        ];
        
        var Contact = React.createClass({
            render: function() {
                return (
                       <li className="contact">
                           <img className="contact-image" src={this.props.image} width="60px" height="60px" />
                           <div className="contact-info">
                               <div className="contact-name">{this.props.name}</div>
                               <div className="contact-number">{this.props.phoneNumber}</div>
                           </div>
                       </li>
                );
            }
        });
        
        var ContactsList = React.createClass({
            getInitialState: function() {
                return {
                    displayedContacts: CONTACTS
                };    
            },
            
            handleSearch: function(event) {
                var searchQuery = event.target.value.toLowerCase(); //берем значение из инпута и приводим к нижнему регистру
                var displayedContacts = CONTACTS.filter(function(el) { //создаем новый массив контактов, который отображается, для этого на списке контактов используем метод filter, который возвращает новый массив только тех элементов, для которых эта функция вернула true
                    var searchValue = el.name.toLowerCase();
                    return searchValue.indexOf(searchQuery) !== -1;
                })
                
                this.setState({
                    displayedContacts: displayedContacts    
                }); 
            },
            
            render: function() {
                return (
                    <div className="contacts">
                        <input type="text" className="search-field" onChange={this.handleSearch}/>
                        <ul className="contacts-list">
                            {
                                this.state.displayedContacts.map(function(el) {
                                    return <Contact key={el.id}
                                                    name={el.name}
                                                    phoneNumber={el.phoneNumber}
                                                    image={el.image}
                                            />;
                                })
                            }
                        </ul>
                    </div>
                );
            }    
        });
        
/* Carousel */
        var IMAGES = [
            {
                id: 1,
                img: 'img/car1.jpg'
            },
            {
                id: 2,
                img: 'img/car2.jpg'
            },
            {
                id: 3,
                img: 'img/car3.jpg'
            }
        ];
        

        var Carousel = React.createClass({
            curElem: false,
            
            handleLeft: function() {
                var carouselInner = document.querySelector('.carousel__inner');
                
                var firstChild = carouselInner.removeChild(carouselInner.firstChild);
                
                carouselInner.appendChild(firstChild);
            },
            
            handleRight: function() {
                var carouselInner = document.querySelector('.carousel__inner');
                
                var lastChild = carouselInner.removeChild(carouselInner.lastChild);
                
                carouselInner.insertBefore(lastChild, carouselInner.firstChild);
            },
            
            render: function() {
                return (
                    <div className="carousel">
                        <div className="carousel__left" onClick={this.handleLeft}></div>
                        <div className="carousel__right" onClick={this.handleRight}></div>
                        <div className="carousel__inner">
                        
                            {
                                IMAGES.map(function(el) {
                                    return <div key={el.id} className="carousel__item"><img className="carousel__img" src={el.img} alt=""/></div>;
                                })
                            }

                        </div>
                    </div>
                );
            }
        });
        

        ReactDOM.render(
            <Carousel />,
            document.getElementById("carousel-wrap")
        );

        ReactDOM.render(
            <ContactsList />,
            document.getElementById("content")
        );


/* Music */
        var Music = React.createClass({
            isPlay: false,
            handlePlay: function() {
                var audio = document.getElementById('audio');
                var music = document.querySelector('.music');
                if (!this.isPlay) {
                    audio.play();
                    audio.volume = 0.5;
                    music.classList.add("music__pause");
                    this.isPlay = true;
                } else {
                    audio.pause();
                    music.classList.remove("music__pause");
                    this.isPlay = false;
                }
                
            },
            render: function() {
                return (
                    <div className="music" onClick={this.handlePlay}>
                        <audio id="audio" src="sound/watchtower.mp3" autoplay>
                        </audio>
                    </div>
                );
            }    
        });

        ReactDOM.render(
            <Music />,
            document.getElementById("music-wrap")
        );

/* Timer */

        var Timer = React.createClass({
            getInitialState: function() {
                return {
                    seconds: 0,
                    isPaused: false,
                    stateInner: function() {
                        if (!this.isPaused) {
                            return "Пауза";
                        } else {
                            return "Старт";
                        }
                    }
                };   
            },
            
            componentDidMount: function() {
                this.timer = setInterval(this.tick, 1000);    
            },
            
            componentWillUnmount: function() {
                clearInterval(this.timer);    
            },
            
            tick: function() {
                this.setState({ seconds: this.state.seconds + 1 });    
            },
            
            handleClick: function() {                
                if (!this.state.isPaused) {
//                    this.pausedSeconds = this.state.seconds;
                    clearInterval(this.timer);
                    this.state.isPaused = true;
                    this.setState(); 
                } else {
                    this.timer = setInterval(this.tick, 1000); 
                    this.state.isPaused = false;
                    this.setState(); 
                }
            },
            
            handleDrop: function() {
                this.setState({ seconds: 0 });          
            },
            
            render: function() {
                return (
                    <div className="timer-inner">
                        <h4> Секунд прошло {this.state.seconds} </h4>
                        <div className="timer-state" onClick={this.handleClick}>{this.state.stateInner()}
                        </div>
                        <div className="timer-reload" onClick={this.handleDrop}>Сбросить</div>
                    </div>
                );
            }
        });

        ReactDOM.render(
            <Timer />,
            document.getElementById("timer-wrap")
        );

/* Notes App */
        
    </script>
    
    <script type="text/babel" src="notes.js"></script>
</body>
</html>